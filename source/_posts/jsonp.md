---
title: jsonpè·¨åŸŸï¼Œå¹¶è°ˆè°ˆå…¶ä»–è·¨åŸŸçš„é—®é¢˜
date: 2017-06-20 08:00:00
tags: [å‰ç«¯æŠ€æœ¯]
---

# è¯´æ˜

å…¬å¸å°ä¼™ä¼´åœ¨ç”¨jQueryåšjsonpè·¨åŸŸè¯·æ±‚æ—¶é‡åˆ°äº†é—®é¢˜ï¼Œéœ€è¦æˆ‘çš„å¸®å¿™ã€‚ç„¶è€Œè™½ç„¶äº†è§£jsonpçš„åŸç†ï¼Œä½†æ˜¯ä»¥å‰ä»æ¥åŠ¨æ‰‹å®ç°è¿‡ï¼Œé‡åˆ°é—®é¢˜è¿˜æ˜¯ä¸€å¤´é›¾æ°´ï¼Œæœ€ç»ˆå•¥éƒ½æ²¡å¸®ä¸Šï¼Œè¿˜æµªè´¹äº†æ—¶é—´ï¼Œå”‰ã€‚å›å®¶åè‡ªå·±å®ç°äº†ä¸€ä¸‹ã€‚ã€‚ã€‚ã€‚

<!-- more -->

è¿™ç¯‡[ç®€ä¹¦](http://www.jianshu.com/p/38449d9452a7)å†™äº†nä¸ªdemoï¼Œè·¨åŸŸåˆ†ç±»ä»‹ç»å¾—å¾ˆå…¨ã€‚

## jsonpåŸç†

1. æµè§ˆå™¨è€ƒè™‘åˆ°å®‰å…¨æ€§ï¼Œç¦æ­¢äº†ä¸åŒæºçš„è¯·æ±‚ã€‚
2. ä½†æ˜¯htmlçš„`<script>`æ ‡ç­¾ä¾‹å¤–ã€‚

## jsonp

``` javascript
//jQuery

$.ajax({
    url: 'xxx',
    dataType: 'jsonp',
    method: 'get',
    jsonp: "callbackparam",//ä¼ é€’ç»™è¯·æ±‚å¤„ç†ç¨‹åºæˆ–é¡µé¢çš„ï¼Œç”¨ä»¥è·å¾—jsonpå›è°ƒå‡½æ•°åçš„å‚æ•°å(é»˜è®¤ä¸º:callback)
    jsonpCallback:"success_jsonpCallback",//è‡ªå®šä¹‰çš„jsonpå›è°ƒå‡½æ•°åç§°ï¼Œé»˜è®¤ä¸ºjQueryè‡ªåŠ¨ç”Ÿæˆçš„éšæœºå‡½æ•°å
    success: function(){}
    })


```

ç„¶åå‘å‡ºçš„è¯·æ±‚å¤§æ¦‚æ˜¯è¿™æ ·çš„ä¸€ä¸ªgetè¯·æ±‚ã€‚

```
http://XXX?callback=jQuery112106434915643629524_1497952489640&_=1497952489641
```

åŸç”Ÿçš„è¯åº”è¯¥æ˜¯è¿™æ ·çš„å†™çš„ã€‚

``` html
<script>
function callback(res) {
    document.write(res)
}
</script>
<script src="http://xxx.com/xxx?jsonpCallback=callback"></script>
```

å…¶å®å°±ç­‰ä»·äº

``` html

<script>   
function callback(res) {
    document.write(res)
}
</script>
<script>callback('server data')</script>

```

å½“ç„¶ï¼Œjsonpä¹Ÿéœ€è¦åå°çš„æ”¯æŒã€‚è¿”å›ä¸€æ®µçº¦å®šçš„JavaScriptæ–¹æ³•è°ƒç”¨

``` javascript
app.get('/', function (req, res) {
    var callbackName = req.query.callback;   // myFunction
    res.send(callbackName+"({'message': 'hello world from JSONP!ğŸ™ƒ'});");
    // myFunction({'message': 'hello world from JSONP!'})
    // ä¸€ä¸ªå¸¦å‚æ•°çš„æ‰§è¡Œå‡½æ•°
})
```

è¿œç¨‹è¿”å›çš„ä¸€æ®µjavascriptæ‰§è¡Œäº†æœ¬åœ°å®šä¹‰å¥½çš„æ–¹æ³•ï¼Œå¹¶æŠŠéœ€è¦çš„å‚æ•°ä¼ ç»™è¯¥æ–¹æ³•å³å¯è¾¾åˆ°è·å–æœåŠ¡å™¨æ•°æ®çš„æ•ˆæœ

## éœ€è¦æ³¨æ„çš„å‡ ç‚¹

* `<script>`æ ‡ç­¾è¯·æ±‚jsæ˜¯`GET`è¯·æ±‚ï¼Œå¹¶ä¸æ”¯æŒå…¶ä»–ç±»å‹çš„è¯·æ±‚ã€‚æ‰€ä»¥ç”¨`POST`æ–¹æ³•åš`jsonp`è¯·æ±‚æ˜¯é”™çš„ï¼ˆå½“ç„¶ï¼ŒjQueryå·²ç»ä¸»åŠ¨å¸®ä½ å†™æˆ`GET`äº†

# å…³äºjQueryå¥‡æ€ªçš„æŠ¥é”™

å½“ç”¨jQueryåšjsonpè¯·æ±‚æ˜¯ï¼Œå¯èƒ½ä¼šæŠ¥`Uncaught SyntaxError: Unexpected token :`é”™ã€‚å¸¸ç†ä¼šè®¤ä¸ºæŸä¸ªåœ°æ–¹å‡ºç°äº†è¯­æ³•é”™è¯¯ã€‚å…¶å®ä¸ç„¶ã€‚é”™è¯¯çš„åœ°æ–¹åœ¨äº`æ¥å£ä¸æ”¯æŒ`ã€‚è¿”å›çš„ç»“æœjQueryæ— æ³•å¤„ç†ã€‚æ‰ä¼šæŠ¥è¿™ä¸ªé”™ã€‚è¯­æ³•é”™è¯¯å¹¶ä¸æ˜¯è¿”å›çš„æ•°æ®è¯­æ³•é”™è¯¯ã€‚

# CORSè·¨åŸŸ

é¡ºä¾¿ä»‹ç»å¦ä¸€ä¸ªå¸¸ç”¨çš„è·¨åŸŸè§£å†³åŠæ³•--CORSè·¨åŸŸ

åŸç†æ˜¯æœåŠ¡å™¨åœ¨httpè¯·æ±‚å¤´é‡Œå†™ä¸Š`Access-Control-Allow-Origin`ã€‚å£°æ˜é‚£äº›åŸŸåå¯ä»¥æ¥æ”¶è¯¥è¯·æ±‚å³å¯ã€‚

æ¯”å¦‚è¯´

``` javascript
app.get('/', (req, res) => {
    res.set('Access-Control-Allow-Origin', 'http://localhost:3000'); // è®¾ç½®å…è®¸è·¨åŸŸçš„originï¼Œå…è®¸3000ç«¯å£è®¿é—®æœ¬ç«¯å£ï¼ˆ3001ï¼‰
    res.send("Hello world from CROS.ğŸ˜¡");   // ç©ºæ ¼éƒ¨åˆ†ä¸ºè¡¨æƒ…ï¼Œå¯èƒ½åœ¨ç¼–è¾‘å™¨ä¸ä¼šæ˜¾ç¤º
});
```

